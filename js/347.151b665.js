(window.webpackJsonp=window.webpackJsonp||[]).push([[347],{1212:function(e,t,n){"use strict";n.r(t),n.d(t,"state",(function(){return S})),n.d(t,"mutations",(function(){return E})),n.d(t,"getters",(function(){return I})),n.d(t,"actions",(function(){return K}));n(50),n(40),n(69),n(38),n(18),n(64),n(70),n(17),n(20),n(22),n(15),n(21);var r=n(4),c=n(0),o=(n(9),n(7),n(35),n(36),n(86),n(41),n(133)),l=n(2),d=n(123),f=n(112),h=n(30),m=n(230),x=n(28),O=n(5),v=n(785),w=n(3);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){l=!0,c=e},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw c}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var R=function(){return Promise.resolve().then(n.bind(null,177))},S=function(){return{assetSignedAuctionAddress:{data:null,status:"success"},claimSellerOffer:{data:null,status:"success"},auction:{data:null,status:"success"},auctions:{data:[],status:"success"},expOwnerAuctions:{data:[],status:"success"},assetAuctions:{data:[],status:"loading"},createAuction:{data:null,status:"success"},futureAuctions:{data:[],status:"loading"},isTransactionApproved:{data:null,status:"success"}}},E=l.c,I=l.b;function P(e,t){return!!e.methods[t]}function T(e,t,n,r,c,o,l,d,f){return $.apply(this,arguments)}function $(){return($=Object(c.a)(regeneratorRuntime.mark((function e(t,n,r,c,o,l,f,x,O){var v,w,k,i,j,y,A,S,E,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v=[],w=[],k=regeneratorRuntime.mark((function e(i){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.AssetSignedAuctionItems.find((function(e){return e.position===i}))){e.next=3;break}throw new m.b("There was an error preparing the asset purchase","api",null);case 3:v.push(t.tokenId),w.push(t.amount);case 5:case"end":return e.stop()}}),e)})),i=0;case 4:if(!(i<n.AssetSignedAuctionItems.length)){e.next=9;break}return e.delegateYield(k(i),"t0",6);case 6:i++,e.next=4;break;case 9:return j=P(o,"claimSellerOffer((address,address,address,uint256[],uint256[],uint256[],uint256[],bytes,bytes))"),e.next=12,R();case 12:return y=e.sent,A=y.default,S=[c,n.Wallet.address,n.tokenAddress,[r,l],[A.toBN(n.offerId,16).toString(10),A.toWei(n.startingPrice.toString(),"ether"),A.toWei(n.endingPrice.toString(),"ether"),n.startedAt,n.duration,n.packs],v,w,n.signature],E=[{buyer:c,seller:n.Wallet.address,token:n.tokenAddress,purchase:[r,l],auctionData:[A.toBN(n.offerId,16).toString(10),A.toWei(n.startingPrice.toString(),"ether"),A.toWei(n.endingPrice.toString(),"ether"),n.startedAt,n.duration,n.packs],ids:v,amounts:w,signature:n.signature,backendSignature:O}],I=j?E:S,e.abrupt("return",Object(h.c)(o,"claimSellerOffer",I,{from:c,value:0},(function(e){return W("buyAssetSuccess",n,e,f,x)}),(function(e){U("buyAssetError",n,e),d.a.unbook(n.id,t,{amount:r})})));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t,n,r,c){return B.apply(this,arguments)}function B(){return(B=Object(c.a)(regeneratorRuntime.mark((function e(t,n,r,c,o){var l,f,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.$nuxt.$gtmEvent({event:t,auction:n}),Object(x.d)("success",r,{},n.layer||O.a.ETHEREUM),!c||!o){e.next=13;break}return(l=Object.assign({},c)).status="purchased",e.next=7,d.a.findAllByTokenId(l.blockchainId);case 7:f=e.sent,h=f.length>0?f[0]:null,l.auction=h,$nuxt.$store.dispatch("cart/cleanItem",l),$nuxt.$store.getters["assetsignedauction/get"]("futureAuctions",[]),$nuxt.$store.getters["assetsignedauction/get"]("auction");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e,t,n){window.$nuxt.$gtmEvent({event:e,auction:t}),Object(x.d)("error",n,{},t.layer||O.a.ETHEREUM)}function C(e,t){var n=Object.assign({},e);n.status=t,$nuxt.$store.dispatch("cart/updateItem",n)}function D(e,t,n,r){return M.apply(this,arguments)}function M(){return(M=Object(c.a)(regeneratorRuntime.mark((function e(t,n,r,c){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.create(t,n,r,f.a.product.ASSET,c);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),e.t0&&e.t0.response&&400!==e.t0.response.status&&console.error(e.t0.response.data);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function H(e,t){return N.apply(this,arguments)}function N(){return(N=Object(c.a)(regeneratorRuntime.mark((function e(t,n){var r,c,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R();case 2:return r=e.sent,c=r.default,o=(t.startingPrice<t.endingPrice?t.endingPrice:t.startingPrice)*n*1.05,e.abrupt("return",c.toWei(o.toString(),"ether"));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t){return F.apply(this,arguments)}function F(){return F=Object(c.a)(regeneratorRuntime.mark((function e(t,n){var r,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:O.a.ETHEREUM,e.next=3,t("sand/checkBalance",{amount:n,layer:r},{root:!0});case 3:if(e.sent){e.next=6;break}throw new Error("Not enough SAND");case 6:case"end":return e.stop()}}),e)}))),F.apply(this,arguments)}function L(e){return z.apply(this,arguments)}function z(){return(z=Object(c.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$nuxt.$store.dispatch("products/updateAssetPrivateFlag",{id:t,value:!1});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return Y.apply(this,arguments)}function Y(){return(Y=Object(c.a)(regeneratorRuntime.mark((function e(t){var n,r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.layer){e.next=2;break}return e.abrupt("return");case 2:if(!t.chainId){e.next=6;break}t.layer=Object(O.e)(t.chainId),e.next=10;break;case 6:return e.next=8,Object(O.q)("Sand",O.a.ETHEREUM,!0);case 8:c=e.sent,t.layer=(null==c||null===(n=c.address)||void 0===n?void 0:n.toLowerCase())===(null===(r=t.tokenAddress)||void 0===r?void 0:r.toLowerCase())?O.a.ETHEREUM:O.a.POLYGON;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K={setProperty:l.f,refreshContract:function(e,address){return Object(O.o)(address,"current",!0,!1,!0)},claimSellerOffer:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function n(){var r,c,o,m,v,w,k,j,y,A,R,S,E,I;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.commit,c=e.dispatch,o=t.bookingId,m=t.auction,v=t.amount,w=t.userAddress,k=t.asset,j=t.backendSignature,y=Object(l.a)(r,"claimSellerOffer"),A=Object(l.a)(r,"isTransactionApproved"),n.prev=4,y.loading("unlocking wallet"),n.next=8,Object(h.l)();case 8:return y.loading("switching network"),n.next=11,J(m);case 11:return n.next=13,Object(O.s)(m.layer,w);case 13:return y.loading("fetching contract"),n.next=16,c("refreshContract",m.contractAddress);case 16:if(R=n.sent){n.next=19;break}throw new Error("Contract not initialized");case 19:return y.loading("validating sand balance"),n.next=22,H(m,v);case 22:return S=n.sent,n.next=25,G(c,S,m.layer);case 25:return y.loading("waiting confirmation"),n.next=28,T(o,m,v,w,R,S,k,c,j);case 28:E=n.sent,y.success(E),Object(x.d)("pending",E,{},m.layer||O.a.ETHEREUM),d.a.extendBooking(m.id,o,{amount:v}).catch((function(){})),D(E,f.a.currency.SAND,S,m.id).catch((function(){})),A.success(!0),n.next=45;break;case 36:throw n.prev=36,n.t0=n.catch(4),I=Object(l.d)(n.t0),C(k,"canceled"),y.error(I),Object(x.b)({title:I}),d.a.unbook(m.id,o,{amount:v}).catch((function(){})),A.success(!1),n.t0;case 45:case"end":return n.stop()}}),n,null,[[4,36]])})))()},cancelSellerOffer:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function n(){var r,o,f,m,v,w,k,j;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.commit,o=e.dispatch,f=e.rootGetters,m=Object(l.a)(r,"cancelSellerOffer"),n.prev=2,m.loading("fetching auction"),n.next=6,o("getAuction",t);case 6:if(v=n.sent){n.next=9;break}throw new Error("Auction not found");case 9:return w=Object(O.c)(f),m.loading("unlocking wallet"),n.next=13,Object(h.l)();case 13:return m.loading("switching network"),n.next=16,Object(O.s)(v.layer,w);case 16:return m.loading("fetching contract"),n.next=19,o("refreshContract",v.contractAddress);case 19:if(k=n.sent){n.next=22;break}throw new Error("Contract not initialized");case 22:return m.loading("waiting confirmation"),n.next=25,Object(h.c)(k,"cancelSellerOffer",["0x"+v.offerId],{from:w},function(){var e=Object(c.a)(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.flagAsCanceling(t);case 2:W("cancelAuctionSuccess",v,n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return U("cancelAuctionError",v,e)}));case 25:j=n.sent,Object(x.d)("pending",j,{},v.layer||O.a.ETHEREUM),m.success(j),n.next=34;break;case 30:throw n.prev=30,n.t0=n.catch(2),m.error(Object(l.d)(n.t0)),n.t0;case 34:case"end":return n.stop()}}),n,null,[[2,30]])})))()},getAuctions:function(e){return Object(c.a)(regeneratorRuntime.mark((function t(){var n,r,c,o,f,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.commit,r=Object(l.a)(n,"auctions"),t.prev=2,r.loading("fetching auctions"),t.next=6,d.a.findAll();case 6:c=t.sent,o=y(c),t.prev=8,o.s();case 10:if((f=o.n()).done){t.next=16;break}return h=f.value,t.next=14,J(h);case 14:t.next=10;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(8),o.e(t.t0);case 21:return t.prev=21,o.f(),t.finish(21);case 24:r.success(c),t.next=31;break;case 27:throw t.prev=27,t.t1=t.catch(2),r.error(Object(l.d)(t.t1)),t.t1;case 31:case"end":return t.stop()}}),t,null,[[2,27],[8,18,21,24]])})))()},getAssetAuctions:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function n(){var r,c,o,f,h,m,x,O,v,w,k,j;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.commit,c=t.tokenId,o=t.sellerId,f=t.asset,h=Object(l.a)(r,"assetAuctions"),n.prev=3,c){n.next=8;break}return h.success([]),Object(l.a)(r,"auction").success(null),n.abrupt("return");case 8:return h.loading("fetching auctions"),Object(l.a)(r,"auction").loading("fetching auction"),n.next=12,d.a.findAllByTokenId(c,{sellerId:o});case 12:m=n.sent,x=y(m),n.prev=14,x.s();case 16:if((O=x.n()).done){n.next=22;break}return v=O.value,n.next=20,J(v);case 20:n.next=16;break;case 22:n.next=27;break;case 24:n.prev=24,n.t0=n.catch(14),x.e(n.t0);case 27:return n.prev=27,x.f(),n.finish(27);case 30:return h.success(m),w=m.length>0?m[0]:null,k=m.length>0&&f?m.find((function(e){return e.Wallet.User.id===f.Creator.id})):null,j=!k||!f||null!=f&&f.creatorSaleSoldout?w:k,Object(l.a)(r,"auction").success(j),n.abrupt("return",j);case 38:throw n.prev=38,n.t1=n.catch(3),h.error(Object(l.d)(n.t1)),n.t1;case 42:case"end":return n.stop()}}),n,null,[[3,38],[14,24,27,30]])})))()},getAssetAuctionsFuture:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function n(){var r,c,o,f,h,m,x,O;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.commit,c=t.tokenId,o=t.walletAddress,f=Object(l.a)(r,"futureAuctions"),c){n.next=7;break}return f.success([]),Object(l.a)(r,"futureAuctions").success(null),n.abrupt("return");case 7:return n.next=9,d.a.findFutureByTokenId(c,{walletAddress:o});case 9:h=n.sent,m=y(h),n.prev=11,m.s();case 13:if((x=m.n()).done){n.next=19;break}return O=x.value,n.next=17,J(O);case 17:n.next=13;break;case 19:n.next=24;break;case 21:n.prev=21,n.t0=n.catch(11),m.e(n.t0);case 24:return n.prev=24,m.f(),n.finish(24);case 27:return f.success(h),Object(l.a)(r,"futureAuctions").success(h),n.abrupt("return",h);case 30:case"end":return n.stop()}}),n,null,[[11,21,24,27]])})))()},getExpOwnerAuctions:Object(w.a)({prop:"expOwnerAuctions",func:d.a.findOwnerAssetAuctionsById}),getAuction:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function n(){var r,c,o,f,h,m;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.commit,c=e.state,o=c.auction.data,f=Object(l.a)(r,"auction"),n.prev=3,f.loading("fetching auction"),n.next=7,d.a.findById(t);case 7:return m=n.sent,n.next=10,J(m);case 10:return o&&null!=(null===(h=o.Wallet)||void 0===h?void 0:h.address)&&m.Wallet.address==o.Wallet.address&&(m.Wallet.User=o.Wallet.User),f.success(m),n.abrupt("return",m);case 15:throw n.prev=15,n.t0=n.catch(3),f.error(Object(l.d)(n.t0)),n.t0;case 19:case"end":return n.stop()}}),n,null,[[3,15]])})))()},createAuction:function(e,data){return Object(c.a)(regeneratorRuntime.mark((function t(){var n,r,c,o,f,m,x;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.commit,r=e.rootGetters,c=Object(l.a)(n,"createAuction"),t.prev=2,c.loading("checking requirements"),o=Object(O.c)(r),c.loading("unlocking wallet"),t.next=8,Object(h.l)();case 8:return c.loading("switching network"),t.next=11,Object(O.s)(Object(O.e)(data.chainId||1),o);case 11:return c.loading("creating auction"),t.next=14,d.a.create(data);case 14:return f=t.sent,c.loading("fetching data"),t.next=18,d.a.getAuctionData(f.id);case 18:return m=t.sent,c.loading("requesting signature"),t.next=22,Object(h.k)(o,m);case 22:return x=t.sent,c.loading("updating auction"),t.next=26,d.a.update(f.id,{signature:x});case 26:if(!data.isAssetPrivate){t.next=29;break}return t.next=29,L(data.assetId);case 29:c.success(j(j({},f),{},{signature:x})),t.next=36;break;case 32:throw t.prev=32,t.t0=t.catch(2),c.error(Object(l.d)(t.t0)),t.t0;case 36:case"end":return t.stop()}}),t,null,[[2,32]])})))()},bookAuction:function(e,t){return Object(c.a)(regeneratorRuntime.mark((function n(){var r,c,f,m,x,w,k,j,y,A,R;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.commit,c=e.dispatch,f=e.rootGetters,m=t.auctionId,x=t.amount,w=t.asset,k=Object(l.a)(r,"bookAuction"),n.prev=3,k.loading("unlocking wallet"),n.next=7,Object(h.l)();case 7:return k.loading("fetching auction"),n.next=10,c("getAuction",m);case 10:if(j=n.sent){n.next=14;break}throw C(w,"failed"),new Error("Auction not found");case 14:return k.loading("switching network"),y=Object(O.c)(f),n.next=18,Object(O.s)(j.layer,y);case 18:return k.loading("validating sand balance"),n.next=21,H(j,x);case 21:return A=n.sent,n.next=24,G(c,A,j.layer);case 24:return k.loading("booking auction"),n.next=27,d.a.book(m,{amount:x});case 27:R=n.sent,k.loading("waiting booking confirmation"),Object(v.a)(d.a.findBookingById,[m,R,{amount:x}],(function(data,e){if(e)return data?e.response&&e.response.status>=500?(C(w,"failed"),k.error(data),!0):(C(w,"failed"),!1):o.a.isAxiosError(e)?(C(w,"failed"),!1):(C(w,"failed"),k.error(Object(l.d)(e)),!0);if(data&&"processing"===data)return C(w,"failed"),!1;var t=Object.assign({},w);return t.status="purchased",data.asset=t,c("claimSellerOffer",data),C(w,"in progress"),k.success(data),!0}),1e3),n.next=37;break;case 32:throw n.prev=32,n.t0=n.catch(3),C(w,"failed"),k.error(Object(l.d)(n.t0)),n.t0;case 37:case"end":return n.stop()}}),n,null,[[3,32]])})))()}}}}]);